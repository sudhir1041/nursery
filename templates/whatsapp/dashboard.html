{# whatsapp_app/templates/whatsapp_app/dashboard.html #}
{% extends "whatsapp/base_whatsapp.html" %} {# Extend the WhatsApp base template #}

{% block whatsapp_content %} {# Override the whatsapp_content block #}
<h3 class="mb-3">Dashboard Overview</h3>
<hr class="mb-4">

{# --- Row for Statistic Cards --- #}
<div class="row g-4"> {# Use g-4 for gutters/spacing between columns #}

    <div class="col-md-6 col-xl-3">
        <div class="card shadow-sm h-100"> {# Use h-100 for equal height cards #}
            <div class="card-body d-flex flex-column"> {# Use flex for content alignment #}
                <div class="d-flex align-items-center mb-2">
                     <div class="fs-2 text-primary me-2"><i class="bi bi-people-fill"></i></div>
                     <h5 class="card-title mb-0">Contacts</h5>
                </div>
                <p class="card-text fs-4 fw-bold">{{ total_contacts|default:"0" }}</p>
                <p class="card-text text-muted mt-auto small">Total contacts synced from WhatsApp interactions.</p> {# mt-auto pushes to bottom #}
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-3">
        <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
                 <div class="d-flex align-items-center mb-2">
                     <div class="fs-2 text-success me-2"><i class="bi bi-chat-left-dots-fill"></i></div>
                     <h5 class="card-title mb-0">Active Chats</h5>
                </div>
                <p class="card-text fs-4 fw-bold">{{ active_chats_count|default:"0" }}</p>
                <p class="card-text text-muted mt-auto small">Contacts with at least one message exchanged.</p>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-3">
        <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
                 <div class="d-flex align-items-center mb-2">
                     <div class="fs-2 text-info me-2"><i class="bi bi-envelope-fill"></i></div>
                     <h5 class="card-title mb-0">Messages Today</h5>
                </div>
                <p class="card-text fs-4 fw-bold">{{ messages_today|default:"0" }}</p>
                <p class="card-text text-muted mt-auto small">
                    <span class="text-success">In: {{ incoming_today|default:"0" }}</span> |
                    <span class="text-primary">Out: {{ outgoing_today|default:"0" }}</span>
                </p>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-3">
        <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
                 <div class="d-flex align-items-center mb-2">
                     <div class="fs-2 text-warning me-2"><i class="bi bi-check2-circle"></i></div>
                     <h5 class="card-title mb-0">Outgoing Delivery</h5>
                </div>
                {# Display Success Rate #}
                <p class="card-text fs-4 fw-bold">{{ success_rate|floatformat:1 }}%</p>
                {# Optional: Progress bar for visualization #}
                <div class="progress mb-2" role="progressbar" aria-label="Delivery Success Rate" aria-valuenow="{{ success_rate|floatformat:0 }}" aria-valuemin="0" aria-valuemax="100" style="height: 5px;">
                  <div class="progress-bar bg-success" style="width: {{ success_rate|floatformat:0 }}%"></div>
                </div>
                <p class="card-text text-muted mt-auto small">Success rate (Delivered/Read). Failed: {{ failed_count|default:"0" }}</p>
            </div>
        </div>
    </div>
</div> {# End row for stats cards #}

{# --- Section for Recent Marketing Campaigns --- #}
<h4 class="mt-5">Recent Marketing Campaigns</h4>
<hr class="mb-3">
{% if recent_campaigns %}
<div class="table-responsive"> {# Make table scrollable on small screens #}
<table class="table table-striped table-hover table-sm"> {# table-sm for less padding #}
    <thead class="table-light">
        <tr>
            <th>Name</th>
            <th>Template</th>
            <th>Status</th>
            <th>Scheduled/Sent</th>
            <th>Created</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for campaign in recent_campaigns %}
        <tr>
            <td>{{ campaign.name }}</td>
            <td>{{ campaign.template.name|default:"N/A" }}</td>
            <td>
                {# Use utility function or template tag for consistent status badges if complex #}
                {% include "whatsapp_app/partials/status_badge.html" with status=campaign.status scheduled_time=campaign.scheduled_time %}
            </td>
            {# Display scheduled time or started time #}
            <td>{{ campaign.scheduled_time|default:campaign.started_at|date:"Y-m-d H:i"|default:"N/A" }}</td>
            <td>{{ campaign.created_at|date:"Y-m-d H:i" }}</td>
             <td>
                {# Link to the campaign detail view #}
                <a href="{% url 'whatsapp_app:campaign_detail' campaign.pk %}" class="btn btn-sm btn-outline-primary" title="View Details">
                    <i class="bi bi-eye"></i> View
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% else %}
<div class="alert alert-secondary" role="alert">
  No marketing campaigns found. <a href="{% url 'whatsapp_app:campaign_create' %}" class="alert-link">Create one?</a>
</div>
{% endif %}

{% endblock whatsapp_content %}

